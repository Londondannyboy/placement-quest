---
export const prerender = true;
import Layout from '../../layouts/Layout.astro';
import { client } from '../../lib/sanity';
import imageUrlBuilder from '@sanity/image-url';
import '../../styles/global.css';

const builder = imageUrlBuilder(client);

function urlFor(source) {
  return builder.image(source);
}

const articles = await client.fetch(`
  *[_type == "post" && !(_id in path("drafts.**"))] | order(publishedAt desc) {
    _id,
    title,
    slug,
    excerpt,
    publishedAt,
    mainImage,
    author-> {
      name,
      slug
    }
  }
`);
---

<Layout title="Articles - Relocation Quest">
  <main class="min-h-screen bg-gradient-to-b from-white to-gray-50">
    <div class="container mx-auto px-6 py-12">
      <header class="text-center mb-12">
        <h1 class="text-5xl font-bold text-gray-900 mb-4">Articles</h1>
        <p class="text-xl text-gray-600">Expert insights on relocating abroad</p>
      </header>
      
      <nav class="flex justify-center gap-6 mb-12">
        <a href="/" class="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition">Home</a>
        <a href="/articles" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition">Articles</a>
        <a href="/studio" class="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition">Studio</a>
      </nav>
      
      <section class="max-w-6xl mx-auto">
        {articles.length === 0 ? (
          <div class="text-center py-12 bg-white rounded-lg shadow">
            <p class="text-gray-600 text-lg">No articles yet. Visit the <a href="/studio" class="text-blue-600 hover:underline">Studio</a> to create some!</p>
          </div>
        ) : (
          <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-6">
            {articles.filter((article: any) => article.slug?.current).map((article: any) => (
              <article class="bg-white rounded-lg shadow hover:shadow-lg transition">
                {article.mainImage && (
                  <img
                    src={urlFor(article.mainImage).width(600).height(400).url()}
                    alt={article.mainImage?.alt || article.title}
                    class="w-full h-48 object-cover rounded-t-lg"
                    loading="lazy"
                  />
                )}
                <div class="p-6">
                  <h2 class="text-xl font-bold text-gray-900 mb-2">
                    <a href={`/articles/${article.slug.current}`} class="hover:text-blue-600 transition">
                      {article.title}
                    </a>
                  </h2>
                  {article.excerpt && (
                    <p class="text-gray-600 mb-4 line-clamp-3">{article.excerpt}</p>
                  )}
                  <div class="flex justify-between items-center text-sm text-gray-500">
                    {article.author && <span>By {article.author.name}</span>}
                    {article.publishedAt && (
                      <time datetime={article.publishedAt}>
                        {new Date(article.publishedAt).toLocaleDateString()}
                      </time>
                    )}
                  </div>
                  <a
                    href={`/articles/${article.slug.current}`}
                    class="inline-block mt-4 text-blue-600 hover:text-blue-700 font-medium"
                  >
                    Read more â†’
                  </a>
                </div>
              </article>
            ))}
          </div>
        )}
      </section>
    </div>
  </main>
</Layout>