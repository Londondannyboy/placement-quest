---
// VideoHero component with Mux integration and performance optimization
export interface Props {
  desktopPlaybackId?: string;
  mobilePlaybackId?: string;
  title?: string;
  subtitle?: string;
  ctaText?: string;
  ctaLink?: string;
}

const {
  desktopPlaybackId = "ew9vFwrawM3Eq1MVGHUZwu4IPoFOHVv002Hal1ei02JXM", // Cyprus video - ONLY ONE THAT WORKS
  mobilePlaybackId = "JUdKl1HO7kRD9FcNhNJLHIdgnLhLVvf3q8EmigNUYv4", // Cyprus low-res mobile - CORRECT PLAYBACK ID!
  title = "Your Journey to Global Living Starts Here",
  subtitle = "Expert guidance on international relocation, visa applications, tax optimization, and building your dream life abroad.",
  ctaText = "Read Latest Articles",
  ctaLink = "/articles"
} = Astro.props;

// Cyprus hero background image
const cyprusHeroImage = "https://images.unsplash.com/photo-1539650116574-75c0c6d4d6d7?ixlib=rb-4.0.3&auto=format&fit=crop&w=2070&q=80";
---

<!-- Preload hero background image for mobile LCP -->
<link rel="preload" as="image" href={cyprusHeroImage} media="(max-width: 767px)" fetchpriority="high" />

<!-- Load Mux Player for both desktop and mobile -->
<script>
  // Load Mux Player for all devices
  if (!window.customElements.get('mux-player')) {
    const script = document.createElement('script');
    script.src = 'https://cdn.jsdelivr.net/npm/@mux/mux-player@2';
    document.head.appendChild(script);
  }
</script>

<div class="relative h-[60vh] md:h-[80vh] lg:min-h-screen overflow-hidden bg-gradient-to-br from-blue-600 to-orange-500">
  <!-- Fallback gradient background (maintains current design) -->
  
  <!-- Desktop Video -->
  <div class="absolute inset-0">
    <mux-player
      playback-id={desktopPlaybackId}
      metadata-video-title="Relocation Quest - Cyprus Desktop"
      metadata-video-id="cyprus-desktop-hero"
      metadata-viewer-user-id="hero-banner-desktop"
      env-key={import.meta.env.PUBLIC_MUX_ENV_KEY || "26hi0t52rcm3pl738jugp7sp8"}
      autoplay
      muted
      loop
      max-resolution="1080p"
      style="width: 100%; height: 100%; object-fit: cover;"
      class="w-full h-full hidden md:block"
      preload="metadata"
      controls="false"
      default-hidden-captions="true"
      disable-cookies="true"
    >
    </mux-player>
  </div>

  <!-- Mobile Video -->
  <div class="absolute inset-0 md:hidden">
    <mux-player
      playback-id={mobilePlaybackId}
      metadata-video-title="Relocation Quest - Cyprus Mobile"
      metadata-video-id="cyprus-mobile-hero"
      env-key={import.meta.env.PUBLIC_MUX_ENV_KEY || "26hi0t52rcm3pl738jugp7sp8"}
      autoplay
      muted
      loop
      playsinline
      max-resolution="480p"
      style="width: 100%; height: 100%; object-fit: cover;"
      class="w-full h-full"
      preload="metadata"
      controls="false"
      default-hidden-captions="true"
      disable-cookies="true"
    >
    </mux-player>
  </div>
  
  <!-- Dark overlay for text readability -->
  <div class="absolute inset-0 bg-black bg-opacity-40"></div>
  
  <!-- Content Overlay -->
  <div class="relative z-10 flex items-center justify-center h-full">
    <div class="text-center text-white max-w-4xl px-4 sm:px-6 lg:px-8 py-8">
      <h1 class="text-4xl sm:text-5xl md:text-6xl font-bold mb-4 leading-tight">
        {title}
      </h1>
      <p class="text-lg sm:text-xl md:text-2xl mb-8 max-w-3xl mx-auto leading-relaxed">
        {subtitle}
      </p>
      <a 
        href={ctaLink}
        class="inline-block bg-white text-blue-600 px-8 py-4 rounded-full font-semibold text-lg hover:bg-gray-100 transition-all duration-300 transform hover:scale-105 shadow-lg"
      >
        {ctaText}
      </a>
    </div>
  </div>
  
  <!-- Simple image optimization for reduced motion -->
  <script>
    // Respect reduced motion preference
    if (window.matchMedia && window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
      // Image is already static, so nothing to disable
      console.log('Reduced motion preference detected - using static hero image');
    }
  </script>
</div>

<style>
  /* Ensure video covers container properly */
  video {
    object-fit: cover;
    width: 100%;
    height: 100%;
  }
  
  /* Smooth transitions for CTA button */
  a {
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  }
  
  /* Loading state for videos */
  video:not([data-loaded]) {
    opacity: 0;
    transition: opacity 0.5s ease-in-out;
  }
  
  video[data-loaded] {
    opacity: 1;
  }
  
  /* Accessibility: Respect reduced motion */
  @media (prefers-reduced-motion: reduce) {
    video {
      display: none !important;
    }
  }
</style>