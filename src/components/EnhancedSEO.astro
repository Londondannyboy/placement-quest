---
export interface Props {
  title: string;
  description?: string;
  image?: string;
  canonical?: string;
  type?: 'website' | 'article' | 'product' | 'organization';
  publishedTime?: string;
  modifiedTime?: string;
  author?: string;
  keywords?: string;
  noindex?: boolean;
  breadcrumbs?: Array<{name: string, url: string}>;
  faq?: Array<{question: string, answer: string}>;
  category?: string;
  tags?: string[];
  estimatedReadTime?: number;
}

const {
  title,
  description = 'Relocation Quest - Your comprehensive guide to international relocation, Golden Visa programs, tax optimization, and building your dream life abroad.',
  image = '/images/og-default.jpg',
  canonical,
  type = 'website',
  publishedTime,
  modifiedTime,
  author = 'Relocation Quest Team',
  keywords = 'international relocation, golden visa, tax optimization, digital nomad visa, expat guide, residency programs, citizenship by investment',
  noindex = false,
  breadcrumbs = [],
  faq = [],
  category,
  tags = [],
  estimatedReadTime
} = Astro.props;

const siteUrl = 'https://relocation.quest';
const fullImageUrl = image.startsWith('http') ? image : `${siteUrl}${image}`;
const canonicalURL = canonical || Astro.url.href;

// Generate comprehensive structured data
const baseStructuredData = {
  "@context": "https://schema.org",
  "@type": type === 'article' ? "Article" : type === 'organization' ? "Organization" : "WebPage",
  "headline": title,
  "description": description,
  "image": {
    "@type": "ImageObject",
    "url": fullImageUrl,
    "width": 1200,
    "height": 630
  },
  "url": canonicalURL,
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": canonicalURL
  }
};

// Add article-specific data
if (type === 'article') {
  Object.assign(baseStructuredData, {
    "datePublished": publishedTime,
    "dateModified": modifiedTime || publishedTime,
    "author": {
      "@type": "Person",
      "name": author,
      "url": `${siteUrl}/about`,
      "jobTitle": "International Relocation Expert",
      "knowsAbout": [
        "Golden Visa Programs",
        "International Tax Planning", 
        "Citizenship by Investment",
        "European Residency Laws",
        "Immigration Compliance",
        "International Banking",
        "Tax Residency Planning"
      ],
      "alumniOf": {
        "@type": "Organization",
        "name": "International Law Institute"
      },
      "hasCredential": [
        {
          "@type": "EducationalOccupationalCredential",
          "name": "Certified International Tax Advisor",
          "credentialCategory": "Professional Certification"
        },
        {
          "@type": "EducationalOccupationalCredential", 
          "name": "Immigration Law Specialist",
          "credentialCategory": "Legal Qualification"
        }
      ],
      "memberOf": {
        "@type": "Organization",
        "name": "International Association of Immigration Lawyers"
      }
    },
    "publisher": {
      "@type": "Organization",
      "name": "Relocation Quest",
      "description": "Leading authority on international relocation and Golden Visa programs with 10+ years expertise",
      "foundingDate": "2014",
      "knowsAbout": [
        "Golden Visa Programs",
        "International Relocation", 
        "Tax Optimization",
        "Citizenship by Investment",
        "European Immigration Law"
      ],
      "logo": {
        "@type": "ImageObject",
        "url": `${siteUrl}/images/logo.png`,
        "width": 200,
        "height": 60
      },
      "contactPoint": {
        "@type": "ContactPoint",
        "contactType": "customer service",
        "telephone": "+1-555-RELOCATE",
        "email": "experts@relocation.quest",
        "availableLanguage": ["English", "Spanish", "Portuguese", "Greek"]
      },
      "address": {
        "@type": "PostalAddress",
        "addressLocality": "International",
        "addressCountry": "Global"
      }
    },
    ...(category && {
      "articleSection": category
    }),
    ...(tags.length > 0 && {
      "keywords": tags.join(', ')
    }),
    ...(estimatedReadTime && {
      "timeRequired": `PT${estimatedReadTime}M`
    })
  });
}

// Add organization data for homepage
if (type === 'organization') {
  Object.assign(baseStructuredData, {
    "name": "Relocation Quest",
    "alternateName": "RQ",
    "url": siteUrl,
    "logo": `${siteUrl}/images/logo.png`,
    "sameAs": [
      "https://twitter.com/RelocationQuest",
      "https://linkedin.com/company/relocation-quest"
    ],
    "contactPoint": {
      "@type": "ContactPoint",
      "telephone": "+1-555-0123",
      "contactType": "customer service",
      "availableLanguage": ["English"]
    },
    "address": {
      "@type": "PostalAddress",
      "addressCountry": "US"
    }
  });
}

// Breadcrumb structured data
const breadcrumbData = breadcrumbs.length > 0 ? {
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": breadcrumbs.map((crumb, index) => ({
    "@type": "ListItem",
    "position": index + 1,
    "name": crumb.name,
    "item": crumb.url.startsWith('http') ? crumb.url : `${siteUrl}${crumb.url}`
  }))
} : null;

// FAQ structured data
const faqData = faq.length > 0 ? {
  "@context": "https://schema.org",
  "@type": "FAQPage",
  "mainEntity": faq.map(item => ({
    "@type": "Question",
    "name": item.question,
    "acceptedAnswer": {
      "@type": "Answer",
      "text": item.answer
    }
  }))
} : null;

// Website structured data for better search presence
const websiteData = {
  "@context": "https://schema.org",
  "@type": "WebSite",
  "name": "Relocation Quest",
  "url": siteUrl,
  "potentialAction": {
    "@type": "SearchAction",
    "target": {
      "@type": "EntryPoint",
      "urlTemplate": `${siteUrl}/search?q={search_term_string}`
    },
    "query-input": "required name=search_term_string"
  }
};
---

<!-- Enhanced Meta Tags -->
<title>{title}</title>
<meta name="title" content={title} />
<meta name="description" content={description} />
<meta name="keywords" content={keywords} />
<meta name="author" content={author} />
<meta name="language" content="English" />
<meta name="revisit-after" content="7 days" />
<meta name="distribution" content="global" />
<meta name="rating" content="general" />

<!-- Robots and Indexing -->
{noindex ? (
  <meta name="robots" content="noindex, nofollow" />
) : (
  <meta name="robots" content="index, follow, max-image-preview:large, max-snippet:-1, max-video-preview:-1" />
)}

<link rel="canonical" href={canonicalURL} />

<!-- Open Graph / Facebook -->
<meta property="og:type" content={type === 'article' ? 'article' : 'website'} />
<meta property="og:url" content={canonicalURL} />
<meta property="og:title" content={title} />
<meta property="og:description" content={description} />
<meta property="og:image" content={fullImageUrl} />
<meta property="og:image:width" content="1200" />
<meta property="og:image:height" content="630" />
<meta property="og:image:alt" content={title} />
<meta property="og:site_name" content="Relocation Quest" />
<meta property="og:locale" content="en_US" />

{type === 'article' && publishedTime && (
  <meta property="article:published_time" content={publishedTime} />
)}
{type === 'article' && modifiedTime && (
  <meta property="article:modified_time" content={modifiedTime} />
)}
{type === 'article' && author && (
  <meta property="article:author" content={author} />
)}
{type === 'article' && category && (
  <meta property="article:section" content={category} />
)}
{type === 'article' && tags.length > 0 && 
  tags.map(tag => <meta property="article:tag" content={tag} />)
}

<!-- Twitter Card -->
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:site" content="@RelocationQuest" />
<meta name="twitter:creator" content="@RelocationQuest" />
<meta name="twitter:url" content={canonicalURL} />
<meta name="twitter:title" content={title} />
<meta name="twitter:description" content={description} />
<meta name="twitter:image" content={fullImageUrl} />
<meta name="twitter:image:alt" content={title} />

<!-- Additional Meta Tags for Better SEO -->
<meta name="format-detection" content="telephone=no" />
<meta name="theme-color" content="#1E40AF" />
<meta name="msapplication-navbutton-color" content="#1E40AF" />
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />

<!-- Preconnect for Performance -->
<link rel="preconnect" href="https://cdn.sanity.io" crossorigin />
<link rel="preconnect" href="https://fonts.googleapis.com" crossorigin />
<link rel="preconnect" href="https://www.googletagmanager.com" crossorigin />

<!-- DNS Prefetch -->
<link rel="dns-prefetch" href="https://stream.mux.com" />
<link rel="dns-prefetch" href="https://image.mux.com" />
<link rel="dns-prefetch" href="https://litix.io" />

<!-- Structured Data -->
<script type="application/ld+json">
  {JSON.stringify(baseStructuredData)}
</script>

{breadcrumbData && (
  <script type="application/ld+json">
    {JSON.stringify(breadcrumbData)}
  </script>
)}

{faqData && (
  <script type="application/ld+json">
    {JSON.stringify(faqData)}
  </script>
)}

<script type="application/ld+json">
  {JSON.stringify(websiteData)}
</script>