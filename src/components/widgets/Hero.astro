---
import { sanityClient } from 'sanity:client';
import imageUrlBuilder from '@sanity/image-url';

const builder = imageUrlBuilder(sanityClient);

function urlFor(source) {
  return builder.image(source);
}

export interface Props {
  title?: string;
  subtitle?: string;
  tagline?: string;
  callToAction?: {
    text: string;
    href: string;
    variant?: 'primary' | 'secondary';
  };
  callToAction2?: {
    text: string;
    href: string;
  };
  image?: any;
}

const {
  title = 'Your Journey to Global Living Starts Here',
  subtitle = 'Expert guidance on international relocation, visa applications, tax optimization, and building your dream life abroad.',
  tagline = 'Relocation Made Simple',
  callToAction,
  callToAction2,
  image,
} = Astro.props;

const latestPosts = await sanityClient.fetch(`*[_type == "post"] | order(publishedAt desc)[0...3] {
  title,
  slug,
  excerpt
}`);
---

<section class="relative min-h-[90vh] flex items-center overflow-hidden">
  <div class="absolute inset-0 bg-gradient-primary opacity-90"></div>
  
  <div class="absolute inset-0">
    <div class="absolute inset-0 bg-gradient-to-br from-primary-600/20 via-transparent to-secondary-600/20"></div>
    <div class="absolute top-0 left-1/2 -translate-x-1/2 w-[800px] h-[800px] bg-gradient-radial from-primary-400/30 via-transparent to-transparent blur-3xl"></div>
    <div class="absolute bottom-0 right-0 w-[600px] h-[600px] bg-gradient-radial from-secondary-400/30 via-transparent to-transparent blur-3xl"></div>
  </div>
  
  <div class="relative z-10 max-w-7xl mx-auto px-4 sm:px-6 py-12 md:py-20">
    <div class="grid lg:grid-cols-2 gap-8 lg:gap-16 items-center">
      <div class="text-center lg:text-left">
        {tagline && (
          <div class="inline-flex items-center gap-2 px-3 py-1 mb-6 text-sm font-medium text-white/90 bg-white/10 backdrop-blur-sm rounded-full border border-white/20">
            <span class="relative flex h-2 w-2">
              <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-white opacity-75"></span>
              <span class="relative inline-flex rounded-full h-2 w-2 bg-white"></span>
            </span>
            {tagline}
          </div>
        )}
        
        <h1 class="text-5xl md:text-6xl lg:text-7xl font-bold text-white mb-6 animate-fade-up">
          {title.split(' ').map((word, index) => (
            <span class={index > 2 ? 'text-transparent bg-clip-text bg-gradient-to-r from-blue-200 to-orange-200' : ''}>
              {word}{' '}
            </span>
          ))}
        </h1>
        
        {subtitle && (
          <p class="text-xl md:text-2xl text-white/80 mb-8 animate-fade-up animation-delay-200">
            {subtitle}
          </p>
        )}
        
        <div class="flex flex-col sm:flex-row gap-4 justify-center lg:justify-start animate-fade-up animation-delay-400">
          {callToAction && (
            <a
              href={callToAction.href}
              class="inline-flex items-center justify-center px-8 py-4 text-lg font-semibold rounded-full transition-all duration-200 transform hover:scale-105 bg-white text-primary-700 hover:bg-gray-100 shadow-xl hover:shadow-2xl"
            >
              {callToAction.text}
              <svg class="ml-2 w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7l5 5m0 0l-5 5m5-5H6" />
              </svg>
            </a>
          )}
          
          {callToAction2 && (
            <a
              href={callToAction2.href}
              class="inline-flex items-center justify-center px-8 py-4 text-lg font-semibold rounded-full transition-all duration-200 transform hover:scale-105 bg-white/10 backdrop-blur-sm text-white border-2 border-white/20 hover:bg-white/20"
            >
              {callToAction2.text}
            </a>
          )}
        </div>
        
        <div class="mt-12 pt-8 border-t border-white/20">
          <p class="text-sm text-white/60 mb-4">Latest insights:</p>
          <div class="space-y-2">
            {latestPosts.map((post) => (
              <a
                href={`/blog/${post.slug.current}`}
                class="block text-white/80 hover:text-white transition-colors duration-150 group"
              >
                <span class="text-sm group-hover:translate-x-1 inline-block transition-transform duration-150">
                  â†’ {post.title}
                </span>
              </a>
            ))}
          </div>
        </div>
      </div>
      
      {image && (
        <div class="relative lg:block animate-fade-in animation-delay-600">
          <div class="relative rounded-2xl overflow-hidden shadow-2xl transform hover:scale-105 transition-transform duration-500">
            <img
              src={urlFor(image).width(800).height(600).url()}
              alt="Global relocation"
              class="w-full h-auto object-cover"
              loading="eager"
            />
            <div class="absolute inset-0 bg-gradient-to-t from-primary-900/50 via-transparent to-transparent"></div>
          </div>
          
          <div class="absolute -top-4 -right-4 w-24 h-24 bg-gradient-to-br from-secondary-400 to-secondary-600 rounded-full blur-xl opacity-60 animate-pulse-slow"></div>
          <div class="absolute -bottom-8 -left-8 w-32 h-32 bg-gradient-to-br from-primary-400 to-primary-600 rounded-full blur-xl opacity-60 animate-pulse-slow animation-delay-1000"></div>
        </div>
      )}
    </div>
  </div>
  
  <div class="absolute bottom-0 left-0 right-0 h-px bg-gradient-to-r from-transparent via-white/20 to-transparent"></div>
  
  <div class="absolute bottom-8 left-1/2 -translate-x-1/2 animate-bounce">
    <svg class="w-6 h-6 text-white/60" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 14l-7 7m0 0l-7-7m7 7V3" />
    </svg>
  </div>
</section>

<style>
  @keyframes fade-up {
    from {
      opacity: 0;
      transform: translateY(20px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }
  
  .animate-fade-up {
    animation: fade-up 0.8s ease-out forwards;
  }
  
  .animation-delay-200 {
    animation-delay: 200ms;
  }
  
  .animation-delay-400 {
    animation-delay: 400ms;
  }
  
  .animation-delay-600 {
    animation-delay: 600ms;
  }
  
  .animation-delay-1000 {
    animation-delay: 1000ms;
  }
</style>